
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ricerca Risorse</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">

    <div class="text-center mb-4">
        <img src="/static/logo.jpeg" alt="Logo" style="max-width: 150px;">
        <div class="mt-2 fw-bold">CAMPEGGIO SANTA MARGHERITA</div>
    </div>

    <h2 class="mb-3">Filtra Risorse</h2>
    <div class="row g-3 mb-4">
        <div class="col-6">
            <label class="form-label">Data (gg/mm/aa):</label>
            <input type="text" id="data" class="form-control" placeholder="Es. 23/04/25">
        </div>
        <div class="col-6">
            <label class="form-label">Dimensione (es. 12,34):</label>
            <input type="text" id="dimensione" class="form-control">
        </div>
    </div>
    <button onclick="search()" class="btn btn-success mb-5">Cerca</button>

    <h3>Risultati</h3>
    <div id="results" class="mb-5"></div>

    <h2 class="mb-3">Aggiorna i file Excel</h2>

    <form id="form-disponibile" class="mb-4">
        <label class="form-label">File Disponibile:</label>
        <input type="file" id="disponibile-file" class="form-control mb-2">
        <button type="submit" class="btn btn-primary">Aggiorna Disponibile</button>
    </form>

    <form id="form-dimensione" class="mb-5">
        <label class="form-label">File Dimensione:</label>
        <input type="file" id="dimensione-file" class="form-control mb-2">
        <button type="submit" class="btn btn-secondary">Aggiorna Dimensione</button>
    </form>

<script>
    document.getElementById('form-disponibile').onsubmit = async function(e) {
        e.preventDefault();
        const fileInput = document.getElementById("disponibile-file");
        if (!fileInput.files.length) {
            alert("Seleziona un file Excel prima di caricare.");
            return;
        }
        const formData = new FormData();
        formData.append("file", fileInput.files[0]);
        const response = await fetch('/upload_disponibile', { method: 'POST', body: formData });
        alert(await response.text());
    };

    document.getElementById('form-dimensione').onsubmit = async function(e) {
        e.preventDefault();
        const fileInput = document.getElementById("dimensione-file");
        if (!fileInput.files.length) {
            alert("Seleziona un file Excel prima di caricare.");
            return;
        }
        const formData = new FormData();
        formData.append("file", fileInput.files[0]);
        const response = await fetch('/upload_dimensione', { method: 'POST', body: formData });
        alert(await response.text());
    };
</script>

<script>
async function search() {
    const data = document.getElementById("data").value;
    const dimensione = document.getElementById("dimensione").value;

    const params = new URLSearchParams({ data, dimensione });
    const response = await fetch(`/search?${params.toString()}`);
    const results = await response.json();

    const container = document.getElementById("results");
    container.innerHTML = "";
    if (results.length === 0) {
        container.innerHTML = "<div class='text-danger'>Nessun risultato trovato.</div>";
    } else {
        results.forEach(r => {
            container.innerHTML += `<div class="card p-2 mb-2">
                <strong>${r.risorsa}</strong><br>
                Disponibile: ${r.disponibile}<br>
                Dimensione: ${r.dimensione}
            </div>`;
        });
    }
}
</script>
</body>
</html>
